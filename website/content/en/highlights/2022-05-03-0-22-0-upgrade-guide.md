---
date: "2022-05-03"
title: "0.22 Upgrade Guide"
description: "An upgrade guide that addresses breaking changes in 0.22.0"
authors: ["spencergilbert"]
pr_numbers: [12124]
release: "0.22.0"
hide_on_release_notes: false
badges:
  type: breaking change
---

Vector's 0.22.0 release includes **breaking changes**:

1. [`gcp_stackdriver_metrics` configuration change](#stackdriver-metrics)
2. [VRL now supports template strings](#vrl-template-strings)
3. [`syslog` source and VRL's `parse_syslog` structured data fields made consistent](#parse-syslog)

We cover them below to help you upgrade quickly:

## Upgrade guide

### Breaking changes

#### `gcp_stackdriver_metrics` configuration change {#stackdriver-metrics}

The `gcp_stackdriver_metrics` sink now matches the `gcp_stackdriver_logs`
configuration, and doesn't require an additional `labels` section to add
labels to submitted metrics.

### TOML transform example

Old configuration

```toml
[sinks.my_sink_id]
type = "gcp_stackdriver_metrics"
inputs = [ "my-source-or-transform-id" ]
credentials_path = "/path/to/credentials.json"
project_id = "vector-123456"

  [sinks.my_sink_id.resource]
  type = "global"

    [sinks.my_sink_id.resource.labels]
    projectId = "vector-123456"
    instanceId = "Twilight"
    zone = "us-central1-a"
```

New configuration

```toml
[sinks.my_sink_id]
type = "gcp_stackdriver_metrics"
inputs = [ "my-source-or-transform-id" ]
credentials_path = "/path/to/credentials.json"
project_id = "vector-123456"

  [sinks.my_sink_id.resource]
  type = "global"
  projectId = "vector-123456"
  instanceId = "Twilight"
  zone = "us-central1-a"
```

For more information on the new syntax, you can review the documentation [here](https://vector.dev/docs/reference/configuration/sinks/gcp_stackdriver_metrics/)


#### [VRL now supports template strings] {#vrl-template-strings}

VRL strings can now be templated. It is now possible to insert the values of
variables by inserting a placeholder with an embedded variable name into the
string using `{{..}}`. For example in the following code:

```coffee
beverage = "coffee"
preference = "I love to drink {{ beverage }}!"

assert!(preference == "I love to drink coffee!")
```

It should be noted that currently the placeholder must contain a simple
variable name and that variable must resolve to a string.

This will not work:

```coffee
stars = 42
sky = "There are {{ stars }} in the sky."
```

Instead, the variable must be converted to a string first:

```coffee
stars = to_string(42)
sky = "There are {{ stars }} in the sky."
```

Also paths are currently not supported, so this will not work:

```coffee
message = "The message is {{ .message }}."
```

Assign the field to a variable first:

```coffee
message = .message
message = "The message is {{ message }}."
```

If you wish to insert `{{` into the string, you can escape using `\{{` and `\}}`.
You also still have the option to use raw strings (`s'...'`):

```coffee
assert!("\{{ right here \}}" == s'{{ right here }}')
```

#### `syslog` source and VRL's `parse_syslog` structured data fields made consistent {#parse-syslog}

Previously, the `parse_syslog` VRL function and the `syslog` source handled parsing the structured
data section of syslog messages differently:

- The `syslog` source inserted a field with the name of the structured data element, with the
  fields as keys in that map. It would create further nested maps if the structured data key names
  had `.`s in them.
- The `parse_syslog` function would instead prefix the structured data keys with the name of the
  structured data element they appeared in, but would insert this as a flat key/value structure
  rather than nesting (so that referencing keys would require quoting to escape the `.`s).

With this release the behavior of both is now to parse the structured data section as a flat map
of string key / string value, and insert it into the target under a field with the name of the
structured data element.

That is:

```
<1>1 2022-04-25T23:21:45.715740Z Gregorys-MacBook-Pro.local 2d4d9490-794a-4e60-814c-5597bd5b7b7d 79978 - [exampleSDID@32473 foo.baz="bar"] test message
```

Now returns (for both the `syslog` source and the `parse_syslog` function):

```json
{
  "appname": "2d4d9490-794a-4e60-814c-5597bd5b7b7d",
  "exampleSDID@32473": {
    "foo.baz": "bar"
  },
  "facility": "kern",
  "hostname": "Gregorys-MacBook-Pro.local",
  "message": "test message",
  "procid": 79978,
  "severity": "alert",
  "timestamp": "2022-04-25T23:21:45.715740Z",
  "version": 1
}
```

Where previously `parse_syslog` returned:

```json
{
  "appname": "2d4d9490-794a-4e60-814c-5597bd5b7b7d",
  "exampleSDID@32473.foo.baz": "bar",
  "facility": "kern",
  "hostname": "Gregorys-MacBook-Pro.local",
  "message": "test message",
  "procid": 79978,
  "severity": "alert",
  "timestamp": "2022-04-25T23:21:45.715740Z",
  "version": 1
}
```

And the `syslog` source returned:

```json
{
  "appname": "2d4d9490-794a-4e60-814c-5597bd5b7b7d",
  "exampleSDID@32473": {
    "foo": {
      "baz": "bar"
    }
  },
  "facility": "kern",
  "hostname": "Gregorys-MacBook-Pro.local",
  "message": "test message",
  "procid": 79978,
  "severity": "alert",
  "timestamp": "2022-04-25T23:21:45.715740Z",
  "version": 1
}
```


The previous `parse_syslog` behavior can be acheived by running the result through the `flatten`
function like:

```
flatten(parse_syslog!(s'<1>1 2022-04-25T23:21:45.715740Z Gregorys-MacBook-Pro.local 2d4d9490-794a-4e60-814c-5597bd5b7b7d 79978 - [exampleSDID@32473 foo.baz="bar"] test message'))
```
